<!-- (C) 2009 Paul Wolneykien <manowar@altlinux.ru> -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  </head>
  <body>
    <h2>Прокси-сервер</h2>

    <h3>Настройка прокси-сервера</h3>

    <p>Несколько компьютеров, объединённых в локальную сеть
    могут быть подключены к глобальной сети (Интернет) через один общий
    канал. Такое решение имеет ряд преимуществ перед другими.
    В частности, если разместить в месте соединения двух сетей
    (<em>шлюзе</em>) прокси-сервер, полученные через него страницы
    попадут в кеш, и при повторном обращении к ним загрузка из внешней
    сети уже не потребуется. Это может существенно ускорить доступ к
    популярным сайтам и снизить потребляемый организацией
    <em>трафик</em>.</p>

    <p>Прокси-сервер принимает запросы из локальной сети и, по мере
    необходимости, передаёт их во внешнюю сеть. Поступление запроса
    ожидается на определённом <em>порту</em>, который по умолчанию имеет
    стандартный номер 3128. Если по каким-то причинам не желательно
    использовать данный порт, то можно поменять его значение на любое
    другое.</p>
      
    <p>Перед тем как выполнить перенаправление запроса, прокси-сервер
    проверяет принадлежность сетевого адрес узла, с которого запрос был
    отправлен к группе внутренних сетевых адресов. Для того, чтобы
    запросы, отправленные из локальной сети, обрабатывались
    прокси-сервером, необходимо добавить соответствующую группу адресов
    (адрес подсети и адресную маску) в список внутренних сетей
    в разделе <em>Сети</em>.</p>
    
    <p>Вторым условием передачи запроса является принадлежность
    <em>целевого порта</em> к разрешённому диапазону. Посмотреть и
    отредактировать список разрешённых целевых портов можно в разделе
    <em>Порты</em>.</p>

    <p>Прокси-сервер может работать в двух режимах: <em>стандартном</em>
    и <em>прозрачном</em>. Стандартный режим использование прокси-сервера
    требует изменения режима работы программ локальной сети, что может
    потребовать их ручной настройки. По этой причине другим популярным
    режимом использования прокси-сервера является прозрачный режим.
    В этом режиме все обращения из внутренней сети по зарегистрированным
    протоколам (портам) во внешнюю сеть автоматически перехватываются
    прокси-сервером при прохождении через шлюз. Программы в локальной
    сети при этом продолжают работать в обычном режиме, не требуя никакой
    специальной настройки. Недостатком прозрачного режима работы
    является невозможность идентификации пользователей — все запросы
    отправляются из локальной сети анонимно. Для указания портов, 
    используемых в режиме прозрачного проксирования, перейдите в раздел
    «Разрешённые протоколы», выберите из списка протокол и установите для
    этого протокола флажок «Включить прозрачное перенаправление».</p>

    <p>Преимуществом непрозрачного режима работы, требующего
    перенастройки программ локальной сети, является возможность
    производить аутентификацию пользователей и контролировать их доступ
    во внешнюю сеть. Для того, чтобы включить аутентификацию, выберите
    <em>способ аутентификации</em>, отличный от «Без аутентификации».
    </p>

    <p>Политика доступа пользователей во внешнюю сеть формируется на
    основе групп пользователей и сетевых доменов в
    разделе <em>Группы</em>. Для каждой группы пользователей может
    быть сформирован список доменов, к которым разрешается, или
    наоборот, запрещается обращение. Внесение и исключение
    пользователей из групп производится с помощью общесистемного
    модуля «Пользователи/Группы». Политики доступа для специальных групп
    «Все пользователи» и «Аутентифицированные пользователи» обрабатываются
    несколько иначе, чем политики доступа для индивидуальных групп
    пользователей.</p>

    <p>Разрешающая политика для группы «Все пользователи» определяет белый
    список доменов с наивысшим приоритетом: доступ к перечисленным доменам
    предоставляется всем без исключения пользователям, без проверки
    дополнительных условий. Разрешение доступа всем пользователям к определённому
    списку доменов удобно, когда вы совершенно не заботитесь об ограничении доступа
    к определённым сайтам, например, поисковым машинам. Однако в случае, если список
    доменов пуст, доступ будет предоставлен ко всем сайтам без исключения, делая все
    остальные правила доступа бессмысленными. Такая установка может быть удобна,
    когда требуется на время отключить ограничение доступа.</p>

    <p>Разрешающая политика для группы «Аутентифицированные пользователи» определяет
    белый список доменов с предыдущим по отношению к вышеописанной политике приоритетом.
    Доступ к перечисленным доменам предоставляется всем прошедшим аутентификацию
    пользователям, без проверки дополнительных условий. Разрешение доступа всем
    прошедшим аутентификацию пользователям к определённому списку доменов удобно, когда
    вы полагаете, что раз пользователь представился системе, то он может получить доступ
    к более широкому кругу сайтов, чем анонимные пользователи. Однако в случае, если
    список доменов пуст, доступ будет предоставлен ко всем сайтам без исключения, делая
    все правила доступа с более низким приоритетом бессмысленными. Такая установка
    удобна, когда вы хотите ограничить доступ в Интернет только для анонимных
    пользователей.</p>

    <p>Индивидуальные политики для групп пользователей устанавливают точечные ограничения
    или разрешения: разрешение доступа к списку доменов не означает запрещение доступа
    для не вошедших в список доменов. Аналогично, запрещение доступа к списку доменов не
    означает разрешение доступа для не вошедших в список доменов. Данные политики имеют
    следующий по отношению к вышеописанной политике приоритет. Имея более высокий, чем
    глобальные запрещающие политики, приоритет, они удобны для формирования исключений.</p>

    <p>Запрещающая политика для группы «Аутентифицированные пользователи» определяет
    чёрный список доменов со следующим, по отношению к индивидуальным политикам групп,
    приоритетом. Доступ к перечисленным сайтам будет запрещён для всех прошедших
    аутентификацию пользователей, если индивидуальная политика хотя бы для одной из
    групп пользователя не предоставляет доступ. Кроме того, доступ будет предоставлен ко
    всем не вошедшим в список сайтам. Такая политика удобна, когда для представившихся
    пользователей вы хотите ограничить доступ только к некоторому небольшому набору сайтов,
    оставив более масштабные ограничения для анонимных пользователей.</p>

    <p>Запрещающая политика для группы «Все пользователи» определяет чёрный список доменов
    с наименьшим приоритетом. Доступ к перечисленным сайтам будет запрещён, если другие
    политики не препятствуют этому, в то время как доступ ко всем не вошедшим в список
    сайтам будет предоставлен. Такая политика удобна, когда вы хотите ограничить доступ
    только к некоторому небольшому набору сайтов.</p>

    <h3>Просмотр статистики работы прокси-сервера</h3>
    
    <p>Пересылка каждого запроса во внешнюю сеть фиксируется
    прокси-сервером в специальном журнале. На основании этих данных
    автоматически формируются отчёты о статистике использования
    ресурсов сети, в том числе потраченного времени и количества
    переданных данных (трафика). С этими отчётами администратор
    может ознакомиться в модуле <em>Статистика/Прокси-сервер</em>. 
    Для включения сборки статистики работы прокси-сервера установите
    флажок «<strong>Включить сбор статистики</strong>», иначе
    новые данные об использовании сети не будет записываться в базу
    данных статистики.</p>

    <p>Основное назначение модуля — это просмотр отчёта об объёме
    полученных из внешней сети данных. В зависимости от режима
    аутентификации пользователей при доступе к прокси-серверу,
    записи отчёта могут содержать как имена пользователей, так и
    адреса локальной сети.</p>

    <p>Отчёт, выводимый на страницу не обновляется автоматически и
    поэтому может содержать устаревшие данные. Для обновления отчёта
    нажмите на кнопку «<strong>Обновить</strong>». При каждом обновлении
    учитываются параметры выборки, которые можно определить над таблицей.
    Данные в таблице отсортированы по убыванию объёма полученных данных.
    </p>

  </body>
</html>
